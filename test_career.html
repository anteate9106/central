<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>직업적성 검사 - 청년들 성격유형 검사 시스템</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* 직업적성 검사 전용 스타일 */
        .test-header {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-bottom: 40px;
        }

        .test-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .test-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .progress-bar {
            background: #f0f0f0;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .question-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .question-number {
            background: #6c757d;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .answer-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .answer-option {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-weight: 500;
        }

        .answer-option:hover {
            border-color: #6c757d;
            background: #f8f9fa;
        }

        .answer-option.selected {
            border-color: #6c757d;
            background: #6c757d;
            color: white;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #6c757d;
            color: #6c757d;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-outline:hover {
            background: #6c757d;
            color: white;
        }

        .result-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .result-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 20px;
        }

        .career-type {
            font-size: 2.5rem;
            font-weight: 700;
            color: #6c757d;
            margin-bottom: 20px;
        }

        .career-description {
            font-size: 1.1rem;
            color: var(--text-color);
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .career-areas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .area-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .area-title {
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .area-description {
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .job-suggestions {
            background: #e9ecef;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .job-suggestions h3 {
            color: var(--dark-color);
            margin-bottom: 15px;
        }

        .job-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .job-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            .test-title {
                font-size: 2rem;
            }
            
            .question-text {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="main-header">
            <a href="test_selection.html" class="logo">
                <div class="logo-icon">💼</div>
                <span class="logo-text">직업적성 검사</span>
            </a>
            <button onclick="logout()" class="btn btn-danger btn-sm">로그아웃</button>
        </div>

        <!-- 테스트 헤더 -->
        <div class="test-header">
            <h1 class="test-title">직업적성 검사</h1>
            <p class="test-subtitle">자신에게 맞는 직업과 진로 방향을 찾아보세요</p>
        </div>

        <div class="test-container">
            <!-- 진행률 표시 -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <!-- 질문 섹션 -->
            <div id="questionSection" class="question-container">
                <div class="question-number" id="questionNumber">1</div>
                <div class="question-text" id="questionText">질문이 로드되는 중...</div>
                <div class="answer-options" id="answerOptions">
                    <!-- 답변 옵션들이 여기에 동적으로 생성됩니다 -->
                </div>
                <div class="navigation-buttons">
                    <button class="btn-outline" id="prevButton" onclick="previousQuestion()" style="display: none;">이전</button>
                    <button class="btn" id="nextButton" onclick="nextQuestion()" disabled>다음</button>
                </div>
            </div>

            <!-- 결과 섹션 (숨김) -->
            <div id="resultSection" class="result-container" style="display: none;">
                <h2 class="result-title">검사 결과</h2>
                <div class="career-type" id="careerType">연구형</div>
                <div class="career-description" id="careerDescription">
                    당신은 연구형 직업적성을 가지고 있습니다.
                </div>
                <div class="career-areas" id="careerAreas">
                    <!-- 직업적성 영역들이 여기에 표시됩니다 -->
                </div>
                <div class="job-suggestions" id="jobSuggestions">
                    <!-- 직업 추천이 여기에 표시됩니다 -->
                </div>
                <div class="navigation-buttons">
                    <button class="btn-outline" onclick="restartTest()">다시 검사하기</button>
                    <button class="btn btn-success" onclick="saveResult()">결과 저장</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/supabase-client.js"></script>
    <script>
        // 직업적성 검사 데이터 (Holland의 6가지 직업적성 이론 기반)
        const careerQuestions = [
            {
                question: "새로운 기술이나 지식을 배우는 것을",
                options: [
                    "매우 좋아한다",
                    "좋아한다",
                    "보통이다",
                    "좋아하지 않는다",
                    "전혀 좋아하지 않는다"
                ]
            },
            {
                question: "문제를 해결할 때 나는",
                options: [
                    "논리적 분석을 통해 접근한다",
                    "창의적 아이디어를 활용한다",
                    "다른 사람과 협력한다",
                    "체계적으로 계획한다",
                    "직관적으로 판단한다"
                ]
            },
            {
                question: "업무 환경에서 나는",
                options: [
                    "조용하고 집중할 수 있는 곳을 선호한다",
                    "활동적이고 역동적인 곳을 선호한다",
                    "사람들과 소통할 수 있는 곳을 선호한다",
                    "안정적이고 예측 가능한 곳을 선호한다",
                    "창의적이고 자유로운 곳을 선호한다"
                ]
            },
            {
                question: "다른 사람들과 함께 일할 때 나는",
                options: [
                    "혼자 일하는 것을 선호한다",
                    "팀의 리더 역할을 한다",
                    "팀원들과 협력한다",
                    "지시받고 따르는 것을 선호한다",
                    "자유롭게 의견을 표현한다"
                ]
            },
            {
                question: "성과를 평가받을 때 나는",
                options: [
                    "개인의 전문성과 능력을 중시한다",
                    "리더십과 성취를 중시한다",
                    "팀워크와 협력을 중시한다",
                    "안정성과 신뢰성을 중시한다",
                    "창의성과 혁신을 중시한다"
                ]
            },
            {
                question: "새로운 프로젝트를 시작할 때 나는",
                options: [
                    "깊이 있게 연구하고 분석한다",
                    "빠르게 실행하고 결과를 만든다",
                    "팀원들과 함께 계획한다",
                    "단계별로 체계적으로 진행한다",
                    "창의적 아이디어를 제시한다"
                ]
            },
            {
                question: "업무에서 가장 중요하게 생각하는 것은",
                options: [
                    "전문성과 정확성",
                    "성과와 성취",
                    "사람과 관계",
                    "안정성과 보장",
                    "창의성과 표현"
                ]
            },
            {
                question: "갈등 상황에서 나는",
                options: [
                    "객관적 분석으로 해결한다",
                    "강력하게 주도한다",
                    "중재와 조정을 한다",
                    "규칙과 절차를 따른다",
                    "창의적 해결책을 찾는다"
                ]
            },
            {
                question: "새로운 도전을 받아들일 때 나는",
                options: [
                    "신중하게 검토한 후 결정한다",
                    "즉시 도전을 받아들인다",
                    "팀원들과 상의한다",
                    "안전성을 확인한다",
                    "흥미로운지 먼저 판단한다"
                ]
            },
            {
                question: "업무에서 만족감을 느끼는 순간은",
                options: [
                    "복잡한 문제를 해결했을 때",
                    "목표를 달성했을 때",
                    "팀원들과 좋은 관계를 맺었을 때",
                    "안정적으로 일을 완료했을 때",
                    "새로운 아이디어를 실현했을 때"
                ]
            }
        ];

        // Holland의 6가지 직업적성 유형
        const careerTypes = {
            'realistic': {
                name: '현실형',
                description: '구체적이고 실용적인 일을 선호하며, 손으로 만드는 작업을 좋아합니다.',
                areas: [
                    { title: '특징', description: '실용적, 현실적, 구체적' },
                    { title: '강점', description: '기술적 능력, 실무 경험' },
                    { title: '가치관', description: '안정성, 실용성, 구체성' },
                    { title: '환경', description: '구체적이고 실용적인 환경' }
                ],
                jobs: ['엔지니어', '기술자', '농업인', '운전사', '요리사', '건축가', '의사', '간호사']
            },
            'investigative': {
                name: '연구형',
                description: '지적 호기심이 강하고 분석적 사고를 통해 문제를 해결하는 것을 좋아합니다.',
                areas: [
                    { title: '특징', description: '분석적, 지적, 독립적' },
                    { title: '강점', description: '연구 능력, 분석력, 논리성' },
                    { title: '가치관', description: '지식, 진실, 객관성' },
                    { title: '환경', description: '학문적이고 연구적인 환경' }
                ],
                jobs: ['과학자', '연구원', '의사', '교수', '프로그래머', '분석가', '심리학자', '통계학자']
            },
            'artistic': {
                name: '예술형',
                description: '창의적이고 표현적인 활동을 선호하며, 자유롭고 유연한 환경을 좋아합니다.',
                areas: [
                    { title: '특징', description: '창의적, 표현적, 자유로운' },
                    { title: '강점', description: '창의성, 표현력, 상상력' },
                    { title: '가치관', description: '미, 창의성, 개성' },
                    { title: '환경', description: '자유롭고 창의적인 환경' }
                ],
                jobs: ['디자이너', '작가', '음악가', '화가', '배우', '사진가', '편집자', '광고기획자']
            },
            'social': {
                name: '사회형',
                description: '다른 사람을 도우고 교육하는 일을 선호하며, 협력과 소통을 중시합니다.',
                areas: [
                    { title: '특징', description: '협력적, 교육적, 도움을 주는' },
                    { title: '강점', description: '소통 능력, 공감력, 교육력' },
                    { title: '가치관', description: '봉사, 협력, 사회적 가치' },
                    { title: '환경', description: '사람 중심의 환경' }
                ],
                jobs: ['교사', '상담사', '사회복지사', '의사', '간호사', '심리학자', '인사담당자', '고객서비스']
            },
            'enterprising': {
                name: '진취형',
                description: '리더십과 경영 능력을 발휘하여 목표를 달성하는 것을 좋아합니다.',
                areas: [
                    { title: '특징', description: '리더십, 경영적, 목표 지향적' },
                    { title: '강점', description: '리더십, 설득력, 경영 능력' },
                    { title: '가치관', description: '성취, 권력, 경제적 성공' },
                    { title: '환경', description: '경쟁적이고 도전적인 환경' }
                ],
                jobs: ['경영자', '영업사원', '정치가', '변호사', '투자자', '마케터', 'CEO', '사업가']
            },
            'conventional': {
                name: '관습형',
                description: '체계적이고 정확한 일을 선호하며, 안정적이고 예측 가능한 환경을 좋아합니다.',
                areas: [
                    { title: '특징', description: '체계적, 정확한, 안정적' },
                    { title: '강점', description: '정확성, 체계성, 신뢰성' },
                    { title: '가치관', description: '안정성, 질서, 전통' },
                    { title: '환경', description: '구조화되고 안정적인 환경' }
                ],
                jobs: ['회계사', '은행원', '사무직', '도서관사서', '비서', '세무사', '공무원', '데이터 입력원']
            }
        };

        // 전역 변수
        let currentQuestion = 0;
        let answers = [];
        let currentUser = null;

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeTest();
        });

        // 테스트 초기화
        async function initializeTest() {
            try {
                // 사용자 정보 확인
                if (window.supabase && window.supabase.isLoggedIn()) {
                    currentUser = await window.supabase.getCurrentUser();
                    if (!currentUser) {
                        redirectToLogin();
                        return;
                    }
                } else {
                    redirectToLogin();
                    return;
                }

                // 첫 번째 질문 표시
                showQuestion(0);
            } catch (error) {
                console.error('테스트 초기화 오류:', error);
                redirectToLogin();
            }
        }

        // 질문 표시
        function showQuestion(questionIndex) {
            const question = careerQuestions[questionIndex];
            
            document.getElementById('questionNumber').textContent = questionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            
            // 답변 옵션 생성
            const answerOptions = document.getElementById('answerOptions');
            answerOptions.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'answer-option';
                optionElement.textContent = option;
                optionElement.onclick = () => selectAnswer(index);
                answerOptions.appendChild(optionElement);
            });
            
            // 이전 답변이 있으면 선택 상태 복원
            if (answers[questionIndex] !== undefined) {
                const selectedOption = answerOptions.children[answers[questionIndex]];
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
            
            // 진행률 업데이트
            updateProgress();
            
            // 네비게이션 버튼 상태 업데이트
            updateNavigationButtons();
        }

        // 답변 선택
        function selectAnswer(answerIndex) {
            // 같은 질문의 다른 옵션들 해제
            const answerOptions = document.querySelectorAll('.answer-option');
            answerOptions.forEach(option => option.classList.remove('selected'));
            
            // 선택된 옵션 활성화
            event.target.classList.add('selected');
            
            // 답변 저장
            answers[currentQuestion] = answerIndex;
            
            // 다음 버튼 활성화
            document.getElementById('nextButton').disabled = false;
        }

        // 다음 질문
        function nextQuestion() {
            if (answers[currentQuestion] === undefined) {
                alert('답변을 선택해주세요.');
                return;
            }
            
            if (currentQuestion < careerQuestions.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
            } else {
                // 마지막 질문이면 결과 계산
                calculateResult();
            }
        }

        // 이전 질문
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        }

        // 진행률 업데이트
        function updateProgress() {
            const progress = ((currentQuestion + 1) / careerQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // 네비게이션 버튼 상태 업데이트
        function updateNavigationButtons() {
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            
            prevButton.style.display = currentQuestion > 0 ? 'block' : 'none';
            
            if (currentQuestion === careerQuestions.length - 1) {
                nextButton.textContent = '결과 보기';
            } else {
                nextButton.textContent = '다음';
            }
        }

        // 결과 계산
        function calculateResult() {
            // 각 직업적성 유형별 점수 계산
            const scores = {
                realistic: 0,
                investigative: 0,
                artistic: 0,
                social: 0,
                enterprising: 0,
                conventional: 0
            };
            
            // 답변에 따라 점수 계산 (간단한 로직)
            answers.forEach((answer, index) => {
                if (answer === 0) scores.investigative += 1;
                else if (answer === 1) scores.enterprising += 1;
                else if (answer === 2) scores.social += 1;
                else if (answer === 3) scores.conventional += 1;
                else if (answer === 4) scores.artistic += 1;
            });
            
            // 가장 높은 점수의 유형 찾기
            const maxScore = Math.max(...Object.values(scores));
            const careerType = Object.keys(scores).find(key => scores[key] === maxScore);
            
            // 결과 표시
            showResult(careerType, scores);
        }

        // 결과 표시
        function showResult(careerType, scores) {
            const typeInfo = careerTypes[careerType];
            
            document.getElementById('careerType').textContent = typeInfo.name;
            document.getElementById('careerDescription').innerHTML = 
                `${typeInfo.description}<br><small>점수: ${scores[careerType]}점</small>`;
            
            // 직업적성 영역 표시
            const areasContainer = document.getElementById('careerAreas');
            areasContainer.innerHTML = '';
            
            typeInfo.areas.forEach(area => {
                const areaCard = document.createElement('div');
                areaCard.className = 'area-card';
                areaCard.innerHTML = `
                    <div class="area-title">${area.title}</div>
                    <div class="area-description">${area.description}</div>
                `;
                areasContainer.appendChild(areaCard);
            });
            
            // 직업 추천 표시
            const jobSuggestionsContainer = document.getElementById('jobSuggestions');
            jobSuggestionsContainer.innerHTML = `
                <h3>💼 추천 직업</h3>
                <div class="job-list">
                    ${typeInfo.jobs.map(job => `<div class="job-item">${job}</div>`).join('')}
                </div>
            `;
            
            // 질문 섹션 숨기고 결과 섹션 표시
            document.getElementById('questionSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';
        }

        // 결과 저장
        async function saveResult() {
            try {
                if (window.supabase && currentUser) {
                    const careerTypeElement = document.getElementById('careerType');
                    const resultData = {
                        type: careerTypeElement.textContent,
                        description: document.getElementById('careerDescription').textContent
                    };
                    
                    await window.supabase.createTestResult({
                        user_id: currentUser.id,
                        test_type: 'Career',
                        result_data: JSON.stringify(resultData),
                        score_data: JSON.stringify(answers)
                    });
                    
                    alert('검사 결과가 저장되었습니다!');
                    window.location.href = 'test_selection.html';
                } else {
                    alert('로그인이 필요합니다.');
                    redirectToLogin();
                }
            } catch (error) {
                console.error('결과 저장 오류:', error);
                alert('결과 저장 중 오류가 발생했습니다.');
            }
        }

        // 테스트 다시 시작
        function restartTest() {
            currentQuestion = 0;
            answers = [];
            document.getElementById('questionSection').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            showQuestion(0);
        }

        // 로그아웃
        function logout() {
            if (window.supabase) {
                window.supabase.removeToken();
            }
            window.location.href = 'index.html';
        }

        // 로그인 페이지로 리다이렉트
        function redirectToLogin() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
